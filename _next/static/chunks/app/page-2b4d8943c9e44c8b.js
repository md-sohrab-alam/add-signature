(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1335:(e,t,a)=>{"use strict";a.d(t,{BZ:()=>l,Pk:()=>c,h1:()=>n,hQ:()=>d,oe:()=>r,x9:()=>o});let i=a(9509).env.NEXT_PUBLIC_GA_MEASUREMENT_ID||"G-XXXXXXXXXX",n=()=>{if(!window.gtag&&"G-XXXXXXXXXX"!==i){let e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=".concat(i),document.head.appendChild(e),window.dataLayer=window.dataLayer||[],window.gtag=function(){window.dataLayer.push(arguments)},window.gtag("js",new Date),window.gtag("config",i,{page_title:document.title,page_location:window.location.href})}},r=e=>{window.gtag&&"G-XXXXXXXXXX"!==i&&window.gtag("config",i,{page_path:e})},s=(e,t,a,n)=>{window.gtag&&"G-XXXXXXXXXX"!==i&&window.gtag("event",e,{event_category:t,event_label:a,value:n})},l=(e,t)=>{s("file_upload","engagement",e,t)},o=e=>{s("signature_created","engagement",e)},d=e=>{s("document_download","engagement",e)},c=()=>{s("text_added","engagement")}},1815:()=>{},2787:()=>{},3237:()=>{},7492:()=>{},7640:()=>{},9398:(e,t,a)=>{Promise.resolve().then(a.bind(a,9534))},9534:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>b});var i=a(5155),n=a(2115),r=a(9196),s=a.n(r),l=a(6670),o=a(2596),d=a(9688);function c(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,d.QP)((0,o.$)(t))}let h=[{name:"Dancing Script",fontFamily:"Dancing Script",className:"font-dancing-script"},{name:"Great Vibes",fontFamily:"Great Vibes",className:"font-great-vibes"},{name:"Parisienne",fontFamily:"Parisienne",className:"font-parisienne"},{name:"Alex Brush",fontFamily:"Alex Brush",className:"font-alex-brush"},{name:"Mr De Haviland",fontFamily:"Mr De Haviland",className:"font-mr-de-haviland"},{name:"Allura",fontFamily:"Allura",className:"font-allura"},{name:"Pinyon Script",fontFamily:"Pinyon Script",className:"font-pinyon-script"},{name:"Rouge Script",fontFamily:"Rouge Script",className:"font-rouge-script"},{name:"Tangerine",fontFamily:"Tangerine",className:"font-tangerine"},{name:"Yellowtail",fontFamily:"Yellowtail",className:"font-yellowtail"},{name:"Sacramento",fontFamily:"Sacramento",className:"font-sacramento"},{name:"Petit Formal Script",fontFamily:"Petit Formal Script",className:"font-petit-formal-script"},{name:"Herr Von Muellerhoff",fontFamily:"Herr Von Muellerhoff",className:"font-herr-von-muellerhoff"},{name:"Lovers Quarrel",fontFamily:"Lovers Quarrel",className:"font-lovers-quarrel"},{name:"Miss Fajardose",fontFamily:"Miss Fajardose",className:"font-miss-fajardose"},{name:"Monsieur La Doulaise",fontFamily:"Monsieur La Doulaise",className:"font-monsieur-la-doulaise"},{name:"Mrs Saint Delafield",fontFamily:"Mrs Saint Delafield",className:"font-mrs-saint-delafield"},{name:"Ruthie",fontFamily:"Ruthie",className:"font-ruthie"},{name:"Stalemate",fontFamily:"Stalemate",className:"font-stalemate"},{name:"Dr Sugiyama",fontFamily:"Dr Sugiyama",className:"font-dr-sugiyama"}];var m=a(5617);function g(e){let{onSave:t,className:a}=e,[r,o]=(0,n.useState)("draw"),[d,g]=(0,n.useState)(""),[u,x]=(0,n.useState)(h[0]),[p,f]=(0,n.useState)("#000000"),[y,w]=(0,n.useState)(!1),[b,v]=(0,n.useState)(72),[j,N]=(0,n.useState)(null),[S,k]=(0,n.useState)(!0),C=(0,n.useRef)(null),F=(0,n.useRef)(null),R=(0,n.useRef)(null),E=e=>{let t=e.getBoundingClientRect(),a=window.devicePixelRatio||1;e.width=t.width*a,e.height=t.height*a;let i=e.getContext("2d");return i&&i.scale(a,a),i},M=(0,n.useCallback)(function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b;return new Promise(i=>{let n=document.createElement("canvas"),r=window.devicePixelRatio||1;n.width=2e3*r,n.height=600*r,n.style.width="2000px",n.style.height="600px";let s=n.getContext("2d");if(s){s.scale(r,r),s.fillStyle=p;let l=a;s.font="".concat(l,"px ").concat(t.fontFamily),s.textRendering="optimizeLegibility",s.imageSmoothingEnabled=!0,s.imageSmoothingQuality="high";let o=s.measureText(e);o.width>1800&&(l=Math.max(l=Math.floor(1800*a/o.width),24),s.font="".concat(l,"px ").concat(t.fontFamily)),s.textBaseline="middle";let d=(2e3-s.measureText(e).width)/2;s.save(),s.translate(d,300),s.rotate(-Math.PI/60),s.fillText(e,0,0),s.restore();let c=new Image;c.onload=()=>{s.clearRect(0,0,n.width,n.height),s.drawImage(c,0,0),i(n.toDataURL("image/png",1))},c.src=n.toDataURL("image/png",1)}else i("")})},[p,b]);(0,n.useEffect)(()=>{"draw"===r&&C.current&&E(C.current.getCanvas())},[r]);let L=async()=>{try{let e="";if("draw"===r){if(!C.current||C.current.isEmpty())return void alert("Please provide a signature");let t=C.current.getTrimmedCanvas(),a=t.getContext("2d");a&&(a.imageSmoothingEnabled=!0,a.imageSmoothingQuality="high"),e=t.toDataURL("image/png",1)}else if("type"===r){if(!d.trim())return void alert("Please type your signature");let t=await M(d,u);if(!t)throw Error("Failed to generate signature image");e=t}else if("upload"===r&&j){let t=document.createElement("canvas"),a=t.getContext("2d");if(!a)throw Error("Failed to get canvas context");t.width=j.width,t.height=j.height,a.imageSmoothingEnabled=!0,a.imageSmoothingQuality="high",await new Promise((i,n)=>{let r=new Image;r.onload=()=>{a.drawImage(r,0,0,j.width,j.height),e=t.toDataURL("image/png",1),i()},r.onerror=()=>n(Error("Failed to load uploaded signature")),r.src=j.dataUrl})}else throw Error("Please provide a signature");t(e)}catch(e){alert(e instanceof Error?e.message:"Error saving signature. Please try again.")}};return(0,i.jsx)("div",{className:c("p-6",a),children:(0,i.jsxs)("div",{className:"space-y-8",children:[(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"Choose How to Add Your Signature"}),(0,i.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,i.jsxs)("button",{onClick:()=>o("draw"),className:c("flex flex-col items-center justify-center p-4 rounded-xl transition-all duration-200","draw"===r?"bg-primary text-white shadow-lg scale-[1.02]":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:[(0,i.jsx)("svg",{className:"w-6 h-6 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),(0,i.jsx)("span",{className:"font-medium",children:"Draw"}),(0,i.jsx)("span",{className:"text-xs mt-1 opacity-80",children:"Use your mouse or touch"})]}),(0,i.jsxs)("button",{onClick:()=>o("type"),className:c("flex flex-col items-center justify-center p-4 rounded-xl transition-all duration-200","type"===r?"bg-primary text-white shadow-lg scale-[1.02]":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:[(0,i.jsx)("svg",{className:"w-6 h-6 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"})}),(0,i.jsx)("span",{className:"font-medium",children:"Type"}),(0,i.jsx)("span",{className:"text-xs mt-1 opacity-80",children:"Choose from styles"})]}),(0,i.jsxs)("button",{onClick:()=>{var e;return null==(e=F.current)?void 0:e.click()},className:c("flex flex-col items-center justify-center p-4 rounded-xl transition-all duration-200","upload"===r?"bg-primary text-white shadow-lg scale-[1.02]":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:[(0,i.jsx)("svg",{className:"w-6 h-6 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),(0,i.jsx)("span",{className:"font-medium",children:"Upload"}),(0,i.jsx)("span",{className:"text-xs mt-1 opacity-80",children:"Use image file"})]})]})]}),(0,i.jsx)("div",{className:"space-y-4",children:(0,i.jsxs)("div",{className:"flex flex-wrap gap-6",children:[(0,i.jsxs)("div",{className:"flex-1 min-w-[200px]",children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Signature Color"}),(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsxs)("button",{onClick:()=>w(!y),className:"w-full h-10 rounded-lg border border-gray-300 flex items-center gap-2 px-3 hover:border-primary transition-colors",style:{backgroundColor:p},children:[(0,i.jsx)("div",{className:"w-6 h-6 rounded border shadow-sm",style:{backgroundColor:p}}),(0,i.jsx)("span",{className:"text-sm",style:{color:function(e){let t=parseInt(e.slice(1,3),16),a=parseInt(e.slice(3,5),16);return(.299*t+.587*a+.114*parseInt(e.slice(5,7),16))/255>.5?"#000000":"#FFFFFF"}(p)},children:p.toUpperCase()})]}),y&&(0,i.jsxs)("div",{className:"absolute z-10 mt-2",children:[(0,i.jsx)("div",{className:"fixed inset-0",onClick:()=>w(!1)}),(0,i.jsx)("div",{className:"relative",children:(0,i.jsx)("div",{className:"absolute p-3 bg-white rounded-lg shadow-xl border",children:(0,i.jsx)(l.jI,{color:p,onChange:e=>{f(e),w(!1)}})})})]})]})]}),"type"===r&&(0,i.jsxs)("div",{className:"flex-1 min-w-[200px]",children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Font Size"}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("input",{type:"range",min:"48",max:"96",value:b,onChange:e=>v(Number(e.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary"}),(0,i.jsxs)("div",{className:"flex justify-between text-xs text-gray-500",children:[(0,i.jsx)("span",{children:"48px"}),(0,i.jsxs)("span",{children:[b,"px"]}),(0,i.jsx)("span",{children:"96px"})]})]})]})]})}),(0,i.jsxs)("div",{className:"space-y-4",children:["draw"===r&&(0,i.jsxs)("div",{className:"border-2 rounded-xl p-4 bg-white shadow-sm",children:[(0,i.jsxs)("div",{className:"text-center mb-4",children:[(0,i.jsx)("h4",{className:"font-medium text-gray-700",children:"Draw Your Signature"}),(0,i.jsx)("p",{className:"text-sm text-gray-500",children:"Use your mouse or touch to sign"})]}),(0,i.jsx)(s(),{ref:C,canvasProps:{className:"w-full h-[200px] border rounded-lg bg-white",style:{width:"100%",height:"200px",backgroundColor:"white",touchAction:"none"}},penColor:p,dotSize:2,minWidth:1.5,maxWidth:3,velocityFilterWeight:.7})]}),"type"===r&&(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{className:"border-2 rounded-xl p-4 bg-white shadow-sm",children:[(0,i.jsxs)("div",{className:"text-center mb-4",children:[(0,i.jsx)("h4",{className:"font-medium text-gray-700",children:"Type Your Signature"}),(0,i.jsx)("p",{className:"text-sm text-gray-500",children:"Enter your name to preview in different styles"})]}),(0,i.jsx)("input",{type:"text",value:d,onChange:e=>g(e.target.value),className:"w-full h-[100px] px-4 rounded-lg border-2 border-gray-200 focus:border-primary focus:ring-0 text-center bg-white transition-colors",style:{fontSize:"".concat(b,"px"),color:p,fontFamily:u.fontFamily,lineHeight:"100px"},placeholder:"Type your name",onKeyDown:e=>{"Enter"===e.key&&e.preventDefault()}})]}),(0,i.jsxs)("div",{className:"border-2 rounded-xl p-4 bg-white shadow-sm",children:[(0,i.jsxs)("div",{className:"text-center mb-4",children:[(0,i.jsx)("h4",{className:"font-medium text-gray-700",children:"Choose a Style"}),(0,i.jsx)("p",{className:"text-sm text-gray-500",children:"Select from available signature styles"})]}),(0,i.jsx)("div",{className:"grid grid-cols-2 gap-4 max-h-[300px] overflow-y-auto p-2",children:h.map(e=>(0,i.jsx)("button",{onClick:()=>x(e),className:c("p-4 border-2 rounded-xl hover:bg-gray-50 transition-all duration-200",u.name===e.name?"border-primary ring-2 ring-primary/20":"border-gray-200"),children:(0,i.jsx)("div",{className:c("text-center",e.className),style:{color:p,fontSize:"".concat(.7*b,"px"),lineHeight:"1.2",transform:"rotate(-2deg)"},children:d||"Preview"})},e.name))})]})]}),"upload"===r&&j&&(0,i.jsxs)("div",{className:"border-2 rounded-xl p-4 bg-white shadow-sm",children:[(0,i.jsxs)("div",{className:"text-center mb-4",children:[(0,i.jsx)("h4",{className:"font-medium text-gray-700",children:"Adjust Your Signature"}),(0,i.jsx)("p",{className:"text-sm text-gray-500",children:"Resize and position as needed"})]}),(0,i.jsx)("div",{className:"relative min-h-[300px]",ref:R,children:(0,i.jsx)(m.p,{default:{x:0,y:0,width:j.width,height:j.height},minWidth:50,minHeight:50,lockAspectRatio:S,bounds:"parent",onResizeStop:(e,t,a,i,n)=>{if(j){let e=parseFloat(a.style.width),t=parseFloat(a.style.height);N(a=>a?{...a,width:e,height:t,aspectRatio:S?a.aspectRatio:e/t}:null)}},style:{display:"flex",alignItems:"center",justifyContent:"center",background:"white"},children:(0,i.jsx)("img",{src:j.dataUrl,alt:"Uploaded signature",className:"w-full h-full object-contain",draggable:!1})})}),(0,i.jsxs)("div",{className:"flex items-center gap-2 mt-4 justify-center",children:[(0,i.jsx)("input",{type:"checkbox",id:"maintainAspectRatio",checked:S,onChange:e=>k(e.target.checked),className:"rounded border-gray-300 text-primary focus:ring-primary"}),(0,i.jsx)("label",{htmlFor:"maintainAspectRatio",className:"text-sm text-gray-600",children:"Maintain aspect ratio"})]})]})]}),(0,i.jsx)("div",{className:"sticky bottom-0 bg-white pt-4 mt-6 border-t",children:(0,i.jsxs)("div",{className:"flex gap-3",children:[(0,i.jsx)("button",{onClick:()=>{if("draw"===r&&C.current){if(C.current.clear(),E(C.current.getCanvas())&&C.current){let e=C.current.getCanvas().getContext("2d");e&&e.scale(1,1)}}else"type"===r&&g("")},className:"flex-1 px-4 py-2.5 text-sm font-medium text-gray-700 bg-white border-2 border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-colors",children:"Clear"}),(0,i.jsx)("button",{onClick:L,className:"flex-1 px-4 py-2.5 text-sm font-medium text-white bg-primary rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-colors",children:"Save"})]})}),(0,i.jsx)("input",{type:"file",ref:F,className:"hidden",accept:"image/png,image/jpeg,image/svg+xml",onChange:e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];if(!a)return;let i=new FileReader;i.onload=e=>{var t;let a=new Image;a.onload=()=>{var t;let i=a.width/a.height,n=Math.min(a.width,400);N({dataUrl:null==(t=e.target)?void 0:t.result,width:n,height:n/i,aspectRatio:i}),o("upload")},a.src=null==(t=e.target)?void 0:t.result},i.readAsDataURL(a)}})]})})}var u=a(4123),x=a(5350),p=a(5499),f=a(643);a(8851),a(2465);var y=a(1335);x.A.GlobalWorkerOptions.workerSrc="//cdnjs.cloudflare.com/ajax/libs/pdf.js/".concat(x.A.version,"/pdf.worker.min.js");let w=e=>{var t,a,r,s,l;let{field:o,onUpdate:d,onDelete:h}=e,[g,u]=(0,n.useState)({width:o.width,height:o.height}),x=(0,n.useRef)(null);return(0,n.useEffect)(()=>{if(x.current){let e=x.current;window.getComputedStyle(e);let t=Math.max(300,e.scrollWidth+40),a=Math.max(100,e.scrollHeight+40);(t!==g.width||a!==g.height)&&(u({width:t,height:a}),d({...o,width:t,height:a}))}},[o.content,null==(t=o.textOptions)?void 0:t.fontSize,null==(a=o.textOptions)?void 0:a.fontFamily]),(0,i.jsx)(m.p,{default:{x:o.position.x,y:o.position.y,width:g.width,height:g.height},position:{x:o.position.x,y:o.position.y},size:{width:g.width,height:g.height},onDragStop:(e,t)=>{d({...o,position:{x:t.x,y:t.y}})},onResizeStop:(e,t,a,i,n)=>{let r=parseFloat(a.style.width),s=parseFloat(a.style.height);u({width:r,height:s}),d({...o,width:r,height:s,position:{x:n.x,y:n.y}})},bounds:"parent",lockAspectRatio:o.maintainAspectRatio,minWidth:300,minHeight:100,className:c("draggable-container group","signature"===o.type?"cursor-move":"cursor-text"),style:{position:"absolute",touchAction:"none",zIndex:50,background:"rgba(255, 255, 255, 0.05)",border:"2px dashed rgba(0, 0, 0, 0.2)",borderRadius:"8px",transition:"border 0.2s, background 0.2s",padding:"10px"},resizeHandleStyles:{bottomRight:{position:"absolute",width:"20px",height:"20px",background:"transparent",right:"-10px",bottom:"-10px",cursor:"se-resize",zIndex:51}},resizeHandleComponent:{bottomRight:(0,i.jsx)("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity",children:(0,i.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-blue-500 bg-white rounded-full shadow-lg p-1",children:(0,i.jsx)("path",{d:"M21 21l-6-6m6 6v-4.8m0 4.8h-4.8"})})})},children:(0,i.jsxs)("div",{ref:x,className:"relative w-full h-full flex flex-col justify-center select-none group-hover:border-blue-400",children:["signature"===o.type?(0,i.jsx)("img",{src:o.content,alt:"Signature",className:"w-full h-full object-contain pointer-events-none",style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain",objectPosition:"center"},draggable:!1}):(0,i.jsx)("textarea",{value:o.content,onChange:e=>d({...o,content:e.target.value}),style:{fontSize:"".concat((null==(r=o.textOptions)?void 0:r.fontSize)||16,"px"),color:(null==(s=o.textOptions)?void 0:s.color)||"#000000",fontFamily:(null==(l=o.textOptions)?void 0:l.fontFamily)||"Arial, sans-serif",width:"100%",height:"100%",resize:"none",border:"none",background:"transparent",padding:"8px",outline:"none"},placeholder:"Enter text here..."}),(0,i.jsxs)("div",{className:"absolute top-0 right-0 flex gap-1 p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,i.jsx)("button",{onClick:h,className:"w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 shadow-lg",title:"Delete",children:"\xd7"}),"signature"===o.type&&(0,i.jsx)("button",{onClick:()=>{d({...o,maintainAspectRatio:!o.maintainAspectRatio})},className:"w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs hover:bg-blue-600 shadow-lg",title:o.maintainAspectRatio?"Unlock aspect ratio":"Lock aspect ratio",children:o.maintainAspectRatio?"\uD83D\uDD12":"\uD83D\uDD13"})]})]})})};function b(){let[e,t]=(0,n.useState)(null),[a,r]=(0,n.useState)(""),[s,l]=(0,n.useState)(!1),[o,d]=(0,n.useState)([]),[c,h]=(0,n.useState)([]),[m,x]=(0,n.useState)(1),[b,v]=(0,n.useState)(0),[j,N]=(0,n.useState)(1),S=(0,n.useRef)(null),k=(0,n.useRef)(null),[C,F]=(0,n.useState)({width:0,height:0});(0,n.useEffect)(()=>()=>{a&&URL.revokeObjectURL(a)},[a]);let R=async e=>{var i;let n=null==(i=e.target.files)?void 0:i[0];if(!n)return;t(n),a&&URL.revokeObjectURL(a);let s=URL.createObjectURL(n);if(r(s),x(1),d([]),h([]),n.type.startsWith("image/")){let e=new Image;await new Promise(t=>{e.onload=()=>{F({width:e.naturalWidth,height:e.naturalHeight}),t()},e.src=s})}if("application/pdf"===n.type){let e=await n.arrayBuffer(),t=(await u.PDFDocument.load(e)).getPages(),a=[];t.forEach((e,t)=>{a.push({id:"text-layer-".concat(t+1),content:"",position:{x:0,y:0},page:t+1,fontSize:12})}),h(a)}(0,y.BZ)(n.type,n.size)},E=async()=>{if(e)try{var t,i,n,r,s,l,d;if(e.type.includes("pdf")){let a=await e.arrayBuffer(),r=await u.PDFDocument.load(a),s=r.getPages(),l=null==(t=k.current)?void 0:t.querySelector(".react-pdf__Page");if(!l)throw Error("Could not find PDF viewer element");let d=l.getBoundingClientRect();for(let e=0;e<s.length;e++){let t=s[e],{width:a,height:l}=t.getSize(),c=a/d.width,h=l/d.height;for(let a of o.filter(t=>!t.page||t.page===e+1))try{if("signature"===a.type){let e=await fetch(a.content).then(e=>e.arrayBuffer()).catch(e=>{throw Error("Failed to load signature image for field ".concat(a.id))}),i=await r.embedPng(e),{width:n,height:s}=i.size(),o=Math.round(a.width*c),d=Math.round(a.height*h),m=Math.round(a.position.x*c),g=l-Math.round(a.position.y*h)-d;t.drawImage(i,{x:m,y:g,width:o,height:d,opacity:1})}else if("text"===a.type){let e=await r.embedFont(u.StandardFonts.Helvetica),s=((null==(i=a.textOptions)?void 0:i.fontSize)||16)*h,o=(e=>{let t=parseInt(e.slice(1,3),16)/255,a=parseInt(e.slice(3,5),16)/255,i=parseInt(e.slice(5,7),16)/255;return{r:t,g:a,b:i}})((null==(n=a.textOptions)?void 0:n.color)||"#000000"),d=a.position.x*c,m=l-a.position.y*h-1.2*s,g=a.content.split(" "),x=a.width*c,p="",f=0;for(let a of g){let i=p?"".concat(p," ").concat(a):a;e.widthOfTextAtSize(i,s)<=x?p=i:(t.drawText(p,{x:d,y:m-f,size:s,font:e,color:(0,u.rgb)(o.r,o.g,o.b)}),f+=1.2*s,p=a)}p&&t.drawText(p,{x:d,y:m-f,size:s,font:e,color:(0,u.rgb)(o.r,o.g,o.b)})}}catch(t){throw Error("Failed to process field on page ".concat(e+1,": ").concat((null==t?void 0:t.message)||"Unknown error"))}}let c=await r.save(),h=new Blob([c],{type:"application/pdf"}),m=URL.createObjectURL(h),g=document.createElement("a");g.href=m,g.download="signed-".concat(e.name),document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(m),(0,y.hQ)(e.name)}else if(e.type.startsWith("image/")){let t=document.createElement("canvas"),i=t.getContext("2d");if(!i)throw Error("Failed to get canvas context");let n=new Image;await new Promise((e,t)=>{n.onload=()=>{e()},n.onerror=()=>t(Error("Failed to load original image")),n.src=a}),t.width=n.naturalWidth,t.height=n.naturalHeight,i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",i.drawImage(n,0,0);let c=null==(r=k.current)?void 0:r.querySelector("img");if(!c)throw Error("Could not find displayed image element");let h=n.naturalWidth/c.clientWidth,m=n.naturalHeight/c.clientHeight;for(let e of o)try{if("signature"===e.type){let t=new Image;await new Promise((a,n)=>{t.onload=()=>{let n=Math.round(e.width*h),r=Math.round(e.height*m),s=Math.round(e.position.x*h),l=Math.round(e.position.y*m);i.imageSmoothingEnabled=!1,i.imageSmoothingQuality="high",i.drawImage(t,s,l,n,r),i.imageSmoothingEnabled=!0,a()},t.onerror=()=>n(Error("Failed to load signature ".concat(e.id))),t.src=e.content})}else if("text"===e.type){let t=Math.round(((null==(s=e.textOptions)?void 0:s.fontSize)||16)*m);i.font="".concat(t,"px ").concat((null==(l=e.textOptions)?void 0:l.fontFamily)||"Arial"),i.fillStyle=(null==(d=e.textOptions)?void 0:d.color)||"#000000",i.textBaseline="top";let a=Math.round(e.position.x*h),n=Math.round(e.position.y*m),r=Math.round(e.width*h),o=1.2*t,c=e.content.split(" "),g="",u=n;for(let e=0;e<c.length;e++){let t=g+c[e]+" ";i.measureText(t).width>r&&e>0?(i.fillText(g,a,u),g=c[e]+" ",u+=o):g=t}i.fillText(g,a,u)}}catch(e){throw e}try{let a=await new Promise((a,i)=>{t.toBlob(e=>{e?a(e):i(Error("Failed to create image blob"))},e.type,1)}),i=URL.createObjectURL(a),n=document.createElement("a");n.href=i,n.download="signed-".concat(e.name),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(i),(0,y.hQ)(e.name)}catch(e){throw e}}}catch(e){alert(e instanceof Error?e.message:"Error saving the document. Please try again.")}};return(0,n.useEffect)(()=>{if((null==e?void 0:e.type.startsWith("image/"))&&k.current){let e=k.current.querySelector("img");if(e){let t=()=>{F({width:e.clientWidth,height:e.clientHeight})};return e.addEventListener("load",t),e.complete&&t(),()=>{e.removeEventListener("load",t)}}}},[e]),(0,i.jsx)("main",{className:"min-h-screen p-8 bg-gray-50",children:(0,i.jsxs)("div",{className:"max-w-6xl mx-auto space-y-8",children:[(0,i.jsxs)("div",{className:"text-center space-y-2",children:[(0,i.jsx)("h1",{className:"text-4xl font-bold text-gray-900",children:"Digital Signature App"}),(0,i.jsx)("p",{className:"text-gray-600",children:"Add your signature to documents and images"})]}),!e&&(0,i.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[(0,i.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Upload Document"}),(0,i.jsx)("div",{className:"flex items-center justify-center w-full",children:(0,i.jsxs)("label",{htmlFor:"file-upload",className:"flex flex-col items-center justify-center w-full h-64 border-2 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition-colors",children:[(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[(0,i.jsx)("svg",{className:"w-10 h-10 mb-3 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),(0,i.jsxs)("p",{className:"mb-2 text-sm text-gray-500",children:[(0,i.jsx)("span",{className:"font-semibold",children:"Click to upload"})," or drag and drop"]}),(0,i.jsx)("p",{className:"text-xs text-gray-500",children:"PDF or Image files"})]}),(0,i.jsx)("input",{id:"file-upload",type:"file",className:"hidden",accept:"application/pdf,image/*",onChange:R,ref:S})]})})]}),e&&(0,i.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,i.jsxs)("div",{className:"flex items-center gap-4",children:[(0,i.jsx)("h2",{className:"text-xl font-semibold",children:"Document Editor"}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("button",{onClick:()=>x(e=>Math.max(1,e-1)),disabled:1===m,className:"px-2 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50",children:"Previous"}),(0,i.jsxs)("span",{className:"text-sm text-gray-600",children:["Page ",m," of ",b]}),(0,i.jsx)("button",{onClick:()=>x(e=>Math.min(b,e+1)),disabled:m===b,className:"px-2 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50",children:"Next"})]})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)("button",{onClick:()=>{if(!C.width||!C.height)return;let e=Math.min(200,.3*C.width),t=Math.max(0,(C.width-e)/2),a=Math.max(0,(C.height-100)/2),i={id:Date.now().toString(),type:"text",position:{x:t,y:a},content:"",page:m,width:e,height:100,textOptions:{fontSize:16,color:"#000000",fontFamily:"Arial, sans-serif"}};d(e=>[...e,i]),(0,y.Pk)()},className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700",children:"Add Text"}),(0,i.jsx)("button",{onClick:()=>l(!0),className:"px-4 py-2 text-sm font-medium text-white bg-primary rounded-lg hover:bg-primary/90",children:"Add Signature"}),(0,i.jsx)("button",{onClick:E,className:"px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700",children:"Save Document"})]})]}),(0,i.jsx)("div",{className:"pdf-container relative",ref:k,children:(0,i.jsx)("div",{className:"pdf-page-container relative",children:e.type.startsWith("image/")?(0,i.jsxs)("div",{className:"relative inline-block",children:[(0,i.jsx)("img",{src:a,alt:"Preview",className:"max-w-full h-auto rounded-lg",style:{maxHeight:"80vh"}}),(0,i.jsx)("div",{className:"absolute inset-0",children:o.filter(e=>!e.page||e.page===m).map(e=>(0,i.jsx)(w,{field:e,onUpdate:t=>{d(a=>a.map(a=>a.id===e.id?t:a))},onDelete:()=>{d(t=>t.filter(t=>t.id!==e.id))}},e.id))})]}):(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{className:"relative mx-auto",style:{width:"fit-content"},children:[(0,i.jsx)(p.A,{file:a,onLoadSuccess:e=>{let{numPages:t}=e;if(v(t),k.current){let e=k.current.querySelector(".react-pdf__Page")||k.current.querySelector("img");e&&F({width:e.clientWidth,height:e.clientHeight})}},children:(0,i.jsx)(f.A,{pageNumber:m,scale:j,renderAnnotationLayer:!0,renderTextLayer:!0})}),(0,i.jsx)("div",{className:"absolute inset-0",style:{pointerEvents:"none"},children:(0,i.jsx)("div",{className:"relative w-full h-full",style:{pointerEvents:"all"},children:o.filter(e=>!e.page||e.page===m).map(e=>(0,i.jsx)(w,{field:e,onUpdate:t=>{d(a=>a.map(a=>a.id===e.id?t:a))},onDelete:()=>{d(t=>t.filter(t=>t.id!==e.id))}},e.id))})})]})})})})]}),s&&(0,i.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,i.jsxs)("div",{className:"bg-white rounded-xl max-w-2xl w-full mx-4 flex flex-col max-h-[90vh]",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center p-4 border-b",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold",children:"Add Your Signature"}),(0,i.jsx)("button",{onClick:()=>l(!1),className:"text-gray-500 hover:text-gray-700",children:"âœ•"})]}),(0,i.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,i.jsx)(g,{onSave:e=>{if(!C.width||!C.height)return;let t=Math.min(800,.8*C.width),a=Math.max(40,(C.width-t)/2),i=Math.max(40,(C.height-250)/2),n={id:Date.now().toString(),type:"signature",position:{x:a,y:i},content:e,page:m,width:t,height:250,maintainAspectRatio:!0};d(e=>[...e,n]),l(!1),(0,y.x9)("custom_signature")}})})]})})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[825,592,340,441,684,358],()=>t(9398)),_N_E=e.O()}]);